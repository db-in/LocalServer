<!DOCTYPE html>
<html lang="en">
  <head>
    <title>LocalServer  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a title="LocalServer  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">LocalServer Docs</a> (100% documented)</p>
        <p class="header-right"><a href="https://github.com/db-in/LocalServer"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">LocalServer Reference</a>
        <img id="carat" src="img/carat.png" />
        LocalServer  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/StubResponse.html">StubResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StubResponse.html">StubResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StubServer.html">StubServer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/StubServer.html">StubServer</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/UITestResponse.html">UITestResponse</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/UITestResponse.html">UITestResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/HTTPMethod.html">HTTPMethod</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/HTTPMethod.html">HTTPMethod</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/LocalServerDelegate.html">LocalServerDelegate</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/LocalServerDelegate.html">LocalServerDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/UITestServer.html">UITestServer</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/UITestServer.html">UITestServer</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/RouteHandler">RouteHandler</a>
              </li>
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:11LocalServer12RouteHandlera">RouteHandler</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='localserver' class='heading'>LocalServer</h1>

<p><a href="https://travis-ci.org/db-in/LocalServer"><img src="https://travis-ci.org/db-in/LocalServer.svg?branch=master" alt="Build Status"></a>
<a href="https://codecov.io/gh/db-in/LocalServer"><img src="https://codecov.io/gh/db-in/LocalServer/branch/master/graph/badge.svg" alt="codecov"></a>
<a href="https://codebeat.co/projects/github-com-db-in-LocalServer-master"><img src="https://codebeat.co/badges/5563135f-7e49-4e66-aa44-b4f6fbb9b331" alt="codebeat badge"></a>
<img src="https://img.shields.io/badge/swift-4.2-red.svg" alt="Version">
<a href="https://db-in.github.io/LocalServer"><img src="https://img.shields.io/cocoapods/p/LocalServer.svg?style=flat" alt="Platform"></a>
<a href="https://img.shields.io/cocoapods/v/LocalServer.svg"><img src="https://img.shields.io/cocoapods/v/LocalServer.svg" alt="CocoaPods Compatible"></a>
<a href="https://github.com/Carthage/Carthage"><img src="https://img.shields.io/badge/Carthage-compatible-4BC51D.svg?style=flat" alt="Carthage compatible"></a></p>
<h2 id='description' class='heading'>Description</h2>

<p><strong>LocalServer</strong> is a framework that provides various options to create a Swift Local Server, that can independently run on simulators and devices, supporting Xcode Parallel Testing. It&rsquo;s made in Swift to create Stub Servers, UITest Servers and providing an easy to use Mock capabilities to create Testing doubles (fakes, stubs, spies and mocks). It supports all Apple platform iOS, MacOS, WatchOS and TVOS.</p>

<p><strong>Features</strong></p>

<ul>
<li>[x] Create Stub servers without changing or injecting any of your existing URLSession code;</li>
<li>[x] Create Stub versions for WKWebView;</li>
<li>[x] Supports Xcode Parallel Testing in simulators and devices;</li>
<li>[x] Stub Server for Unit Testing;</li>
<li>[x] UITest Stub Server for UI Testing;</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>
<h3 id='using-a-href-https-cocoapods-org-cocoapods-a' class='heading'>Using <a href="https://cocoapods.org">CocoaPods</a></h3>

<p>Add to your <strong>Podfile</strong> file</p>
<pre class="highlight plaintext"><code>pod 'LocalServer'
</code></pre>
<h3 id='using-a-href-https-github-com-carthage-carthage-carthage-a' class='heading'>Using <a href="https://github.com/Carthage/Carthage">Carthage</a></h3>

<p>Add to your <strong>Cartfile</strong> or <strong>Cartfile.private</strong> file</p>
<pre class="highlight plaintext"><code>github "db-in/LocalServer"
</code></pre>
<h3 id='using-a-href-https-swift-org-package-manager-swift-package-manager-a' class='heading'>Using <a href="https://swift.org/package-manager">Swift Package Manager</a></h3>

<p>Add to your <strong>Package.swift</strong> file</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">package</span> <span class="o">=</span> <span class="kt">Package</span><span class="p">(</span>
    <span class="nv">name</span><span class="p">:</span> <span class="s">"myproject"</span><span class="p">,</span>
    <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/db-in/LocalServer"</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="nv">targets</span><span class="p">:</span> <span class="p">[</span>
        <span class="o">.</span><span class="nf">target</span><span class="p">(</span>
            <span class="nv">name</span><span class="p">:</span> <span class="s">"myproject"</span><span class="p">,</span>
            <span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span><span class="s">"LocalServer"</span><span class="p">]),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre>
<h2 id='programming-guide' class='heading'>Programming Guide</h2>

<p>The features provided are:</p>

<ul>
<li>Stub Server</li>
<li>UITest Server</li>
</ul>
<h4 id='stub-server' class='heading'>Stub Server</h4>

<p>The Stub Server is the base for the Local Server. It can intercept any network call made with the URLSession.</p>

<p><img src="./Resources/StubServer.png" alt="Stub Server"></p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">LocalServer</span>

<span class="kd">func</span> <span class="nf">startMyLocalServer</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">server</span> <span class="o">=</span> <span class="kt">StubServer</span><span class="p">()</span>

    <span class="n">server</span><span class="o">.</span><span class="nf">route</span><span class="p">([</span><span class="o">.</span><span class="kt">GET</span><span class="p">],</span> <span class="nv">url</span><span class="p">:</span> <span class="s">"https://apple.com"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">parameters</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">StubResponse</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">StubResponse</span><span class="p">()</span><span class="o">.</span><span class="nf">withStatusCode</span><span class="p">(</span><span class="mi">204</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">server</span><span class="o">.</span><span class="nf">route</span><span class="p">([</span><span class="o">.</span><span class="kt">POST</span><span class="p">],</span> <span class="nv">url</span><span class="p">:</span> <span class="s">"https://apple.com"</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">StubResponse</span><span class="p">()</span><span class="o">.</span><span class="nf">withStatusCode</span><span class="p">(</span><span class="mi">206</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kt">StubServer</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">server</span>
<span class="p">}</span>
</code></pre>

<p>Once the <code><a href="Classes/StubServer.html#/instance">StubServer.instance</a></code> is defined as non-nil, it will spin the Local Server. To stop the Local Server just set it back to <code>nil</code>, which is the default value.</p>
<h4 id='uitest-server' class='heading'>UITest Server</h4>

<p>As per Apple design, the UITest target runs on a separated application, which means it can&rsquo;t have access to the code in the main application or perform any programaticaly action. The UITest Server used the <code>ProcessInfo</code> bridge to send data from the UITest target to the main application on every launch.</p>

<p>As per Testing best practices, every UITest case should restart the main Application.</p>

<p><img src="./Resources/UITestServer.png" alt="UITest Server"></p>

<p>Project Structure</p>
<pre class="highlight swift"><code><span class="c1">// UITest Target</span>
 <span class="o">|--</span> <span class="kt">LocalServer</span>
 <span class="o">|--</span> <span class="kt">JsonFile1</span><span class="o">.</span><span class="n">json</span>
 <span class="o">|--</span> <span class="kt">JsonFile2</span><span class="o">.</span><span class="n">json</span>
 <span class="o">|--</span> <span class="kt">JsonFile2</span><span class="o">.</span><span class="n">json</span>

<span class="c1">// Main Target</span>
 <span class="o">|--</span> <span class="kt">LocalServer</span>
</code></pre>

<p>Required Code</p>
<pre class="highlight swift"><code><span class="c1">// UITest Target</span>
<span class="kt">UITestResponse</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">withStatusCode</span><span class="p">(</span><span class="mi">201</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="s">"google.com"</span><span class="p">)</span>

<span class="c1">// Main Target</span>
<span class="kt">UITestServer</span><span class="o">.</span><span class="nf">start</span><span class="p">()</span> 
</code></pre>
<h2 id='faq' class='heading'>FAQ</h2>

<blockquote>
<p>Can I ship LocalServer to production (App Store)?</p>
</blockquote>

<ul>
<li>Yes, absolutely. The main goal is to provide Mock and Stub capabilities, but nothing stops you to use it in production if required.</li>
</ul>

<blockquote>
<p>If I&rsquo;m only using it for Debug purpose, shall I use <code>#if DEBUG</code>?</p>
</blockquote>

<ul>
<li>As a dynamic Swift framework, LocalServer will only be loaded in runtime at the moment it&rsquo;s first called. So if your production code never makes use of any LocalServer API, it will not even be loaded. <code>#if DEBUG</code> can be used, but as per UITest Standards, you can also consider the usage of something like <code>XCUIApplication().launchArguments</code> + <code>if ProcessInfo().arguments.contains(&quot;-UITests&quot;) { ... }</code></li>
<li><a href="https://useyourloaf.com/blog/ui-testing-quick-guide">UI Testing Quick Guide/</a></li>
<li><a href="https://www.swiftbysundell.com/posts/getting-started-with-xcode-ui-testing-in-swift">Getting Started With Xcode UI Testing In Swift</a></li>
</ul>

<blockquote>
<p>Can I simulate a slow network response?</p>
</blockquote>

<ul>
<li>Yes, you can use the <code>delay</code> property in any response object to simulate that.</li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2019 <a class="link" href="https://github.com/db-in/LocalServer.git" target="_blank" rel="external">Diney Bomfim</a>. All rights reserved. (Last updated: 2019-03-09)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.5</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
